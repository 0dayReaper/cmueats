"use strict";function getEateryTagline(e,t,r){var a=new Date(e),n=a.getDay()===r.day,i=apiFmtToInt(dateToAPIFmt(a))>apiFmtToInt(r);(!n||n&&i)&&a.setDate(a.getDate()+(r.day-1-a.getDay()+7)%7+1),a.setHours(r.hour),a.setMinutes(r.min),a.setSeconds(0),a.setMilliseconds(0);var s=moment(a),o=t?"Closes in ":"Opens in ";return o+=s.fromNow().charAt(0).toLowerCase()+s.fromNow().slice(1),o+=" ("+s.calendar()+")"}var dateToAPIFmt=function(e){var t=new Date(e);return{day:t.getDay(),hour:t.getHours(),min:t.getMinutes()}},apiFmtToInt=function(e){return 1e4*e.day+100*e.hour+e.min},apiFmtCompare=function(e,t){var r=apiFmtToInt(e),a=apiFmtToInt(t);return r-a},genEateryMetadata=function(e,t){for(var r=e.times,a=apiFmtToInt(dateToAPIFmt(t)),n=r.map(function(e){var t=apiFmtToInt(e.start),r=apiFmtToInt(e.end);return r>t?a>=t&&r>a:a>=t||r>a}).reduce(function(e,t){return e||t},!1),i=r.map(function(e){return apiFmtToInt(n?e.end:e.start)}),s=0,o=0;o<i.length;++o)i[o]<a&&(s=(o+1)%i.length);return{isOpen:n,nextTime:n?r[s].end:r[s].start}},Eatery=React.createClass({displayName:"Eatery",render:function(){var e;getEateryTagline(this.props.time,this.props.eatery.isOpen,this.props.eatery.nextTime);return e=this.props.eatery.isOpen?"open_eatery":"closed_eatery",React.createElement("div",{className:e},React.createElement("h2",null,this.props.eatery.name),React.createElement("p",null,this.props.eatery.location))}}),EateryList=React.createClass({displayName:"EateryList",render:function(){var e=this.props.eateryList.map(function(e){return React.createElement(Eatery,{key:e.name,eatery:e,time:this.props.time})}.bind(this));return React.createElement("div",{className:"eateryList"},e)}}),EateryContainer=React.createClass({displayName:"EateryContainer",getInitialState:function(){return{eateries:[],currentTime:new Date(Date.now()).toJSON()}},reloadFromServer:function(){$.getJSON(this.props.url,function(e){this.setState({eateries:e.locations,currentTime:new Date(Date.now()).toJSON()})}.bind(this))},reloadUI:function(){this.setState({eateries:this.state.eateries,currentTime:new Date(Date.now()).toJSON()})},componentDidMount:function(){var e=5e3,t=25e4;this.reloadFromServer(),setInterval(this.reloadUI,e),setInterval(this.reloadFromServer,t)},render:function(){var e=this.state.eateries.map(function(e){var t=genEateryMetadata(e,this.state.currentTime);return e.isOpen=t.isOpen,e.nextTime=t.nextTime,e}.bind(this)),t=e.filter(function(e){return e.isOpen}).sort(function(e,t){return apiFmtCompare(e.nextTime,t.nextTime)}),r=e.filter(function(e){return!e.isOpen}).sort(function(e,t){return apiFmtCompare(e.nextTime,t.nextTime)});return React.createElement("div",{className:"eateryContainer"},React.createElement(EateryList,{eateryList:t,time:this.state.currentTime}),React.createElement(EateryList,{eateryList:r,time:this.state.currentTime}))}});ReactDOM.render(React.createElement(EateryContainer,{url:"http://apis.scottylabs.org/dining/v1/locations"}),document.getElementById("content"));